---
layout: fexo
title: 实现一个cli工具
date: 2019-05-29T16:51:30.000Z
tags: null
permalink: 2019-05-29-implement-a-cli-tool
---
##### 一. babel
##### 安装使用
```bash
npm install --save-dev @babel/core @babel/cli @babel/preset-env 
npm install --save @babel/polyfill
```
##### 区分:
* core: 核心代码, transform函数
```bash
const babel = require("@babel/core");

babel.transform("code", optionsObject);
```
* babel-cli: 命令行工具
```bash

npm install --save-dev @babel/core @babel/cli

./node_modules/.bin/babel src --out-dir lib //--out-dir可以简写为-d
```
* plugin&&preset: babel需要插件支持编译, 如箭头函数插件,presets就是多种插件的预设集合, 最常用的是preset-env
```bash
npm install --save-dev @babel/preset-env

./node_modules/.bin/babel src --out-dir lib --presets=@babel/env 
```
* polyfill: 安装polyfill之后可以直接使用内置Promise, WeakMap, Array.from()等方法, 注意安装的时候使用--save参数, **对于框架作者或者工具作者也许不需要这些**
```
npm install --save @babel/polyfill
```
npx

> You can use the npm package runner that comes with npm@5.2.0 to shorten that command by replacing ./node_modules/.bin/babel with npx babel


安装babel-cli对我们的代码进行转义
```bash
npm install babel-cli babel-env -D
```
babel-cli使用
```bash
babel script.js
```
完整文档: https://babeljs.io/docs/en/babel-cli/

package.json中配置命令, 打包主文件到dist目录下
```bash
"compile": "babel src -d dist",
"watch": "npm run compile -- --watch"
```
配置.babelrc文件
```bash
{
  "presets": [
    [
      "@babel/preset-env",
      {
        "targets": { 
  	      	"node": "current",
  	      	"esmodules": true  //不指明的话使用import会报错
    	  },
      }
    ]
  ]
}
```
##### 二. 配置bin参数,npm link进行链接
bin参数: 在执行mycli的时候, 执行对应的文件, 注意在设置package.json后要运行 **npm link**,将我们的包链接到npm全局下
```
"bin": {
    "vv-cli": "./bin/vv-cli"
  },
```
https://stackoverflow.com/questions/25333570/npm-package-json-bin-wont-work-on-windows

#### 这行代码是做什么的?
```bash
#! /usr/bin/env node 
```
https://stackoverflow.com/questions/33509816/what-exactly-does-usr-bin-env-node-do-at-the-beginning-of-node-files

node.js中有v8引擎, 我们在运行node.js代码的时候是这样的
```bash
node  index.js
```
在类Unix系统中, 首行的**#!/usr/bin/env**告诉操作系统该使用何种编译器编译文件, windows系统中会忽略这行命令, 但是npm包要求必须带上这行命令 

#### 解析命令行参数 commander
遇到bug的时候使用浏览器打断点看看源码
https://medium.com/@paul_irish/debugging-node-js-nightlies-with-chrome-devtools-7c4a1b95ae27
安装commander包: https://www.npmjs.com/package/commander
```bash
npm install commander
```
第一个命令
```bash
import program  from 'commander';

import { VERSION } from './utils/constant';

program
   .command('setup')
   .description('run remote setup commands')
   .action(function() {
     console.log('setup');
   });
program.version(VERSION, '-v --version').parse(process.argv);
```
运行"vv-cli setup", 控制台打印正确信息
