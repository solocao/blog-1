---
layout: fexo
title: '实现angluar手记[六]属性查找和函数调用'
date: 2019-07-17T12:49:55.000Z
tags:
  - angular
permalink: 2019-07-17-build-your-own-angular-property-lookup
---
`non-computed lookup` (as opposed to a computed a[b] lookup):
当属性值不存在的时候返回Undefined
```javascript
function (s) {
    var v0;
    if (s) {
        v0 = s.aKey;
    }
    return v0;
}
```
* 自定义的if_语句
```javascript
ASTCompiler.prototype.if_ = function(test, consequent) {
    this.state.body.push('if(', test, '){', consequent, '}');
};
```

* 使用uuid来生成变量名 'v' + uuid
```javascript
this.state = { body: [], nextId: 0};


ASTCompiler.prototype.nextId = function () {
    var id = 'v' + this.state.nextId++;
    return id;
}
```

## this查找
直接返回s即可
```
case AST.ThisExpresssion:
    return 's';
```

## 非计算属性值查找


## 层叠属性
先看test
```javascript
var fn = parse('aKey.anotherKey');
expect(fn({ aKey: { anotherKey: 42 } })).toBe(42);
```
生成的JS是这样的
```javascript
(function anonymous(s) {
    var v0, v1;
    if (s) {
        v1 = (s).aKey;
    }
    if (v1) {
        v0 = (v1).anotherKey;
    }
    return v0;
}
)

```
