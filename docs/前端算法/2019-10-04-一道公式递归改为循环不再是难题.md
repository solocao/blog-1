---

title: "一道公式递归改为循环不再是难题"
date: 2019-10-05T16:54:52.000Z
tags: null
permalink: 2019-10-04-change-recursion-to-iteration
---

## 导言

js 中没有尾递归优化, 递归改循环很有必要

目标: 找出一个通用公式

本文主要参考了:[Tricks of the trade: Recursion to Iteration, Part 1: The Simple Method, secret features, and accumulators](http://blog.moertel.com/posts/2013-05-11-recursive-to-iterative.html),原文是用 python 写的, 英语好的朋友可以看看原文

## 公式

1. 理解函数的功能
2. 将递归改为尾递归
3. 引入一个一次循环
4. 将`return`归改为`continue`语句
5. 重构函数

## 例子:阶乘函数

阶乘函数的递归版本

```js
function factorial(n) {
  if (n < 2) {
    return 1;
  }
  return n * factorial(n - 1);
}
```

改为尾递归, 这一步有难度的话, 可以看看文末关于递归转为尾递归的总结,这里为保持连续性,暂时不插入

```js
function factorial(n, acc = 1) {
    if (n < 2) {
      return 1 * acc
    }
    return n * factorial(n-1, acc)
  }
}
```

引入循环语句`while + break`

```js
function factorial(n, acc = 1) {
  while (true) {
    if (n < 2) {
      return 1 * acc;
    }
    return n * factorial(n - 1, acc);
    break; // 避免死循环爆栈
  }
}
```

分析 return 语句做的事情, 将`return`语句改为`赋值 + continue`的形式

```js
function factorial(n, acc = 1) {
  while (true) {
    if (n < 2) {
      return 1 * acc;
    }
    n = n - 1;
    acc = acc * n;
    continue;
    break; // 避免死循环爆栈
  }
}
```

重构函数, 使其整洁

```js
function factorial(n, acc = 1) {
  while (n > 1) {
    acc = acc * n;
    n = n - 1;
  }
  return acc;
}
```
